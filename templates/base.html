<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}GameSpecial{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Flash —Å–æ–æ–±—â–µ–Ω–∏—è -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="nav-links">
            <a href="{{ url_for('home') }}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            {% if session.user_id %}
                <a href="{{ url_for('view_profile', username=session.username) }}">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</a>
                <a href="{{ url_for('find_game') }}">üîé –ù–∞–π—Ç–∏ —Å–æ—é–∑–Ω–∏–∫–æ–≤</a>
                <a href="{{ url_for('messages') }}">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è 
                    <span id="unreadCounter" class="unread-counter"></span>
                </a>
                <a href="{{ url_for('logout') }}">üö™ –í—ã–π—Ç–∏ ({{ session.username }})</a>
            {% else %}
                <a href="{{ url_for('login') }}">üîë –í–æ–π—Ç–∏</a>
                <a href="{{ url_for('register') }}">‚ûï –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            {% endif %}
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main>
            {% block content %}{% endblock %}
        </main>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        function updateUnreadCount() {
            fetch('/api/unread_count')
                .then(response => response.json())
                .then(data => {
                    const counter = document.getElementById('unreadCounter');
                    if (data.unread_count > 0) {
                        counter.textContent = data.unread_count;
                        counter.style.display = 'inline-flex';
                    } else {
                        counter.style.display = 'none';
                    }
                })
                .catch(error => console.error('Error fetching unread count:', error));
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(updateUnreadCount, 30000);
        updateUnreadCount(); // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    </script>
</body>
</html>